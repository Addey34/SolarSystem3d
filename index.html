<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3D Solar System | Three.js</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: #000;
        font-family: Arial, sans-serif;
      }
      .controls {
        position: fixed;
        top: 20px;
        left: 0;
        right: 0;
        display: flex;
        justify-content: center;
        gap: 10px;
        flex-wrap: wrap;
        z-index: 100;
        padding: 10px;
      }
      .controls button.active {
        background: rgba(100, 150, 255, 0.7);
        border-color: white;
      }
      button {
        padding: 10px 15px;
        background: rgba(0, 0, 0, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        cursor: pointer;
        font-size: 14px;
        border-radius: 4px;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
        min-width: 80px;
      }
      button:hover {
        background: rgba(50, 50, 50, 0.7);
      }
      #loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        z-index: 1000;
        transition: opacity 0.5s;
      }
      .loader-content {
        text-align: center;
        padding: 20px;
      }
      .progress-bar {
        width: 200px;
        height: 4px;
        background: #333;
        margin: 20px auto;
        overflow: hidden;
      }
      .progress {
        height: 100%;
        background: #fff;
        width: 0%;
        transition: width 0.3s;
      }
      #fullscreen-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 10px;
        background: rgba(0, 0, 0, 0.5);
        border: none;
        color: white;
        border-radius: 50%;
        cursor: pointer;
        z-index: 100;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      canvas {
        display: block;
      }
    </style>
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.161.0/examples/jsm/",
          "@tweenjs/tween.js": "https://cdn.jsdelivr.net/npm/@tweenjs/tween.js@18.6.4/dist/tween.esm.js"
        }
      }
    </script>
  </head>
  <body>
    <div id="loader">
      <div class="loader-content">
        <h2>Loading Solar System...</h2>
        <div class="progress-bar">
          <div class="progress" id="load-progress"></div>
        </div>
        <div id="load-status">Initializing...</div>
      </div>
    </div>

    <div class="controls">
      <button id="orbit-sun">Sun</button>
      <button id="orbit-mercury">Mercury</button>
      <button id="orbit-venus">Venus</button>
      <button id="orbit-earth">Earth</button>
      <button id="orbit-moon">Moon</button>
      <button id="orbit-mars">Mars</button>
      <button id="orbit-jupiter">Jupiter</button>
      <button id="orbit-saturn">Saturn</button>
      <button id="orbit-uranus">Uranus</button>
      <button id="orbit-neptune">Neptune</button>
    </div>

    <button id="fullscreen-btn" title="Fullscreen">â›¶</button>

    <script type="module">
      import { main } from './src/main.js';

      // Fullscreen functionality
      document
        .getElementById('fullscreen-btn')
        .addEventListener('click', () => {
          if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().catch((err) => {
              console.error('Fullscreen error:', err);
            });
          } else {
            document.exitFullscreen();
          }
        });

      // Initialize with progress updates
      const progressBar = document.getElementById('load-progress');
      const loadStatus = document.getElementById('load-status');

      function updateProgress(progress, message) {
        progressBar.style.width = `${progress}%`;
        loadStatus.textContent = message;
      }

      async function setupPlanetControls(cameraManager) {
        const buttons = document.querySelectorAll('.controls button');

        buttons.forEach((button) => {
          button.addEventListener('click', () => {
            const planetId = button.id.replace('orbit-', '');
            console.log(`Clicked on ${planetId} button`);

            buttons.forEach((btn) => btn.classList.remove('active'));
            button.classList.add('active');

            if (cameraManager) {
              console.log(`Setting target to ${planetId}`);
              cameraManager.setTarget(planetId);
              setTimeout(() => {
                console.log(
                  'After setTarget - camera position:',
                  cameraManager.camera.position
                );
                console.log(
                  'Target position:',
                  cameraManager.targetObject.position
                );
              }, 100);
            } else {
              console.error('Camera manager is not available');
            }
          });
        });
      }

      async function loadApp() {
        try {
          updateProgress(10, 'Loading core components...');

          // Initialize the app and get camera manager
          const { cameraManager } = await main(updateProgress);

          // Setup planet controls after initialization
          if (cameraManager) {
            await setupPlanetControls(cameraManager);
          }

          // Hide loader with fade effect
          setTimeout(() => {
            document.getElementById('loader').style.opacity = '0';
            setTimeout(() => {
              document.getElementById('loader').style.display = 'none';
            }, 500);
          }, 500);
        } catch (error) {
          console.error('Application Error:', error);
          document.getElementById('loader').innerHTML = `
            <div style="text-align: center;">
                <h2 style="color: red;">Application Error</h2>
                <p>${error.message}</p>
                <button onclick="window.location.reload()" style="padding: 10px 20px; margin-top: 20px;">
                    Retry
                </button>
            </div>
          `;
        }
      }

      // Start the application
      loadApp();
    </script>
  </body>
</html>
